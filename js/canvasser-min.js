function initCanvasser(t,e,n){window[t]=new canvasser(t,e,n)}function canvasser(t,e,n){function o(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&e(JSON.parse(n.responseText)),404==n.status&&console.error("JSON File Load Error: "+n.statusText+" "+n.readyState)},n.overrideMimeType("application/json"),n.open("GET",t,!0),n.send(null)}function i(e){C.canvas=document.createElement("canvas"),C.context=C.canvas.getContext("2d"),C.canvas.width=e.settings.canvaswidth,C.canvas.height=e.settings.canvasheight,C.data=e,document.getElementById(e.settings.canvasparent).innerHTML="",document.getElementById(e.settings.canvasparent).appendChild(C.canvas),C.canvas.addEventListener("mousemove",d,!1),C.canvas.addEventListener("mousedown",m,!1),C.canvas.addEventListener("mouseup",f,!1),C.canvas.addEventListener("mouseleave",p,!1),C.canvas.addEventListener("onmouseenter",l,!1),C.canvas.addEventListener("touchstart",h,!1),C.canvas.addEventListener("touchmove",y,!1),C.canvas.addEventListener("touchend",v,!1),void 0!==C.data.paths&&C.data.paths.forEach(function(t){C.pathList[t.id]=t.url}),C.data.images.forEach(function(t){var e=new Image;e.onload=function(){C.imageList[t.id]={},C.imageList[t.id].imageData=this,C.imageList[t.id].canvas=document.createElement("canvas"),C.imageList[t.id].canvas.width=this.width,C.imageList[t.id].canvas.height=this.height,C.imageList[t.id].context=C.imageList[t.id].canvas.getContext("2d"),C.imageList[t.id].context.drawImage(this,0,0,this.width,this.height)},void 0!=t.path&&(t.url=C.pathList[t.path]+"/"+t.url),e.src=t.url}),C.vars={},void 0!=C.data.vars&&C.data.vars.forEach(function(t){C.vars[t.name]=t.value});var n=Array.from(document.querySelectorAll('[data-canvasser="'+t+'"]'));n.length>0&&n.forEach(function(e){e.addEventListener("click",function(){window[t].external(JSON.parse(e.getAttribute("data-canvasser-command")))})}),""!==window.location.hash&&window[t].external([{command:"selectonly",item:window.location.hash.substring(1)}]),s()}function a(){this.position={x:0,y:0},this.prevPosition={x:0,y:0},this.curveList=[],this.imageList=[],this.pathList=[],this.applyAction=[],this.mouseDown=!1,this.mouseDownCnt=0,this.external=!1,this.mode="none",this.dragging=null,this.touch=[]}function r(){function t(){this.pList=[]}var e=[];this.create=function(n){var o=new t;o.info=n,e.push(o)},this.update=function(){e.forEach(function(t){if(t.info.emitCounter>0)for(t.info.emitCounter--,cnt=0;cnt<t.info.emitRate;cnt++){var e={x:D(-.5,.5),y:D(-.5,.5)},n=D(t.info.pParams.scale.min,t.info.pParams.scale.max),o=P(t.info.pParams.life.min,t.info.pParams.life.max),i={position:D(t.info.pParams.speed.position.min,t.info.pParams.speed.position.max),rotation:D(t.info.pParams.speed.rotation.min,t.info.pParams.speed.rotation.max)},a=E(e);t.pList.push({position:t.info.position.current,rotation:0,dirNorm:a,scale:n,speed:i,life:{max:o,current:o}})}var r=T(t.info.position.current,t.info.position.destination,t.info.position.rate);if(t.info.position.current=r.newCurrent,t.info.position.destination=r.newDestination,void 0!==C.imageList[t.info.image]){var s={x:C.imageList[t.info.image].imageData.naturalWidth/2,y:C.imageList[t.info.image].imageData.naturalHeight/2};t.pList.forEach(function(e){if(e.life.current--,e.life.current>0){e.position={x:e.position.x+e.dirNorm.x*e.speed.position,y:e.position.y+e.dirNorm.y*e.speed.position};var n=e.scale,o=e.life.max-e.life.current,i=o/e.life.max,a=1;100*i<t.info.pParams.fadePercent.in&&(a=o/(e.life.max*(.01*t.info.pParams.fadePercent.in))),100*i>t.info.pParams.fadePercent.out&&(a=e.life.current/(e.life.max-e.life.max*(.01*t.info.pParams.fadePercent.out)));var r={x:parseInt(e.position.x+s.x),y:parseInt(e.position.y+s.y)};e.rotation+=e.speed.rotation,C.context.save(),C.context.translate(r.x,r.y),C.context.globalCompositeOperation="source-over",C.context.globalAlpha=a,C.context.rotate(e.rotation),C.context.drawImage(C.imageList[t.info.image].imageData,-s.x*n,-s.y*n,C.imageList[t.info.image].imageData.naturalWidth*n,C.imageList[t.info.image].imageData.naturalHeight*n),C.context.restore(),C.context.globalAlpha=1,C.context.globalCompositeOperation="source-over"}})}})}}function s(){C.canvas.scale=C.canvas.scrollWidth/C.canvas.width,"true"===C.mode&&(C.mode="none"),C.mouseDown?(C.mouseDownCnt++,C.position.x!==C.prevPosition.x&&C.position.y!==C.prevPosition.y&&C.mouseDownCnt>2&&(C.mode="drag",C.canvas.style.cursor="move"),x()):C.canvas.style.cursor="default",C.context.clearRect(0,0,C.canvas.width,C.canvas.height),C.external||(C.applyAction=[]),C.data.objects.forEach(function(t){if(void 0!==t.parent&&void 0===t.parent.object&&C.data.objects.forEach(function(e){e.name===t.parent.name&&(t.parent.object=e)}),"shape"===t.type&&t.show){var e=u(C,t.parent.object,t.position.current,C.data.shapes[t.shape],t.color,t.testp,C.position,t.scale.current);if(!t.testp)return;e&&C.applyAction.push(t)}if("image"===t.type){if(void 0===C.imageList[t.image])return;if(void 0!==t.parent){var n={current:{x:0,y:0}},o={current:1};if(void 0!==t.parent.object&&(n=t.parent.object.position,o=t.parent.object.scale),void 0===t.position.offset&&(t.position.offset={x:t.position.current.x-n.current.x,y:t.position.current.y-n.current.y}),void 0===t.scale.offset&&(t.scale.offset=t.scale.current-o.current),void 0!==t.position.destination){var i=({x:n.current.x+Math.floor(t.position.destination.x*o.current),y:n.current.y+Math.floor(t.position.destination.y*o.current)},T(t.position.offset,t.position.destination,t.position.rate));t.position.offset=i.newCurrent,t.position.destination=void 0===i.newDestination?void 0:t.position.destination}t.position.current={x:n.current.x+Math.floor(t.position.offset.x*o.current),y:n.current.y+Math.floor(t.position.offset.y*o.current)},t.scale.current=o.current}var i=T(t.position.current,t.position.destination,t.position.rate);t.position.current=i.newCurrent,t.position.destination=i.newDestination,c(t,"scale"),c(t,"opacity");var a={x:t.position.current.x,y:t.position.current.y};if((0===t.scale.current||NaN===t.scale.current||t.scale.current<0)&&(t.scale.current=.01),"center"===t.origin&&(a={x:Math.floor(a.x-C.imageList[t.image].imageData.naturalWidth/2*t.scale.current),y:Math.floor(a.y-C.imageList[t.image].imageData.naturalHeight/2*t.scale.current)}),t.show){if(C.context.globalAlpha=void 0!==t.opacity.current?t.opacity.current:1,C.context.drawImage(C.imageList[t.image].imageData,a.x,a.y,C.imageList[t.image].imageData.naturalWidth*t.scale.current,C.imageList[t.image].imageData.naturalHeight*t.scale.current),C.context.globalAlpha=1,!t.testp)return;var r=C.imageList[t.image].context.getImageData(Math.floor((C.position.x-a.x)/t.scale.current),Math.floor((C.position.y-a.y)/t.scale.current),1,1).data;0!=r[3]&&C.applyAction.push(t)}}}),j.update(),C.prevPosition={x:C.position.x,y:C.position.y},window.requestAnimationFrame(s)}function c(t,e){void 0===t[e]&&(t[e]={current:1,rate:0}),void 0!==t[e].destination&&(t[e].showbefore&&(t.show=!0,t[e].showbefore=!1),t[e].current<t[e].destination&&(t[e].current+=t[e].rate),t[e].current>t[e].destination&&(t[e].current-=t[e].rate),(t[e].current===t[e].destination||t[e].current+t[e].rate>=t[e].destination&&t[e].current-t[e].rate<=t[e].destination)&&(t[e].current=t[e].destination,t[e].hideafter&&(t.show=!1),t[e].destination=void 0,t[e].hideafter=!1))}function u(t,e,n,o,i,a,r,s){var c=t.context,u=!1,d=0,f={x:0,y:0,scale:1};void 0!==e&&(f={x:e.position.current.x,y:e.position.current.y,scale:e.scale.current});var l={x:parseInt(n.x*f.scale+f.x),y:parseInt(n.y*f.scale+f.y)},p=s*f.scale;return c.beginPath(),o.forEach(function(t){"move"===t.type&&c.moveTo(l.x+t.offset.x*p,l.y+t.offset.y*p),"rect"===t.type&&c.rect(l.x+t.offset.x*p,l.y+t.offset.y*p,t.width*p,t.height*p),"arc"===t.type&&c.arc(l.x+t.offset.x*p,l.y+t.offset.y*p,t.radius*p,t.startangle,t.endangle,t.counterclockwise),"bcurve"===t.type&&c.bezierCurveTo(l.x+t.offseta.x*p,l.y+t.offseta.y*p,l.x+t.offsetb.x*p,l.y+t.offsetb.y*p,l.x+t.offsetc.x*p,l.y+t.offsetc.y*p),"line"===t.type&&c.lineTo(l.x+t.offset.x*p,l.y+t.offset.y*p),"linewidth"===t.type&&(c.lineWidth=t.width*p),"fillStyle"===t.type&&(null===i?c.fillStyle=t.color:c.fillStyle=i[d]),"fill"===t.type&&c.fill(),"filltext"===t.type&&(c.fillStyle=i[d],c.fillText(t.text,l.x+t.offset.x*p,l.y+t.offset.y*p)),"stroketext"===t.type&&(c.lineWidth=t.stroke,c.strokeStyle=i[d],c.strokeText(t.text,l.x+t.offset.x*p,l.y+t.offset.y*p)),"outlinetext"===t.type&&(c.lineWidth=t.stroke,c.strokeStyle=i[d],c.strokeText(t.text,l.x+t.offset.x*p,l.y+t.offset.y*p),d++,c.fillStyle=i[d],c.fillText(t.text,l.x+t.offset.x*p,l.y+t.offset.y*p)),"font"===t.type&&(c.font=t.size*p+"px "+t.font),"strokestyle"===t.type&&(null===i?c.strokeStyle=t.color:c.strokeStyle=i[d]),"stroke"===t.type&&c.stroke(),"ptest"===t.type&&a&&c.isPointInPath(r.x,r.y)&&(u=!0),"close"===t.type&&c.closePath(),"begin"===t.type&&(c.beginPath(),d++)}),c.closePath(),u}function d(t){var e=C.canvas.getBoundingClientRect();C.position={x:(t.clientX-e.left)/C.canvas.scale,y:(t.clientY-e.top)/C.canvas.scale}}function f(){C.mode="none",C.mouseDown=!1,C.mouseDownCnt=0,null!==C.dragging&&(C.applyAction=[C.dragging],C.mode="drop",C.dragging=null,x())}function l(){C.mode="none",C.mouseDown=!1,C.mouseDownCnt=0}function p(){C.mode="none",C.mouseDown=!1,C.mouseDownCnt=0,C.dragging=null}function m(){C.mode="click",C.external=!1,C.mouseDown=!0,C.mouseDownCnt=0}function h(t){t.preventDefault();for(var e=C.canvas.getBoundingClientRect(),n=0;n<t.changedTouches.length;n++)C.touch.push(g(t.changedTouches[n])),C.position={x:(t.changedTouches[n].pageX-e.left)/C.canvas.scale,y:(t.changedTouches[n].pageY-e.top)/C.canvas.scale};C.mode="click",C.external=!1,C.mouseDown=!0,C.mouseDownCnt=0}function y(t){var e=C.canvas.getBoundingClientRect();t.preventDefault();for(var n=0;n<t.changedTouches.length;n++){var o=t.changedTouches[n].identifier;o>=0&&(C.position={x:(t.changedTouches[n].pageX-e.left)/C.canvas.scale,y:(t.changedTouches[n].pageY-e.top)/C.canvas.scale},C.touch.splice(o,1,g(t.changedTouches[n])))}}function v(t){t.preventDefault();for(var e=C.canvas.getBoundingClientRect(),n=0;n<t.changedTouches.length;n++){var o=t.changedTouches[n].identifier;o>=0&&(C.position={x:(t.changedTouches[n].pageX-e.left)/C.canvas.scale,y:(t.changedTouches[n].pageY-e.top)/C.canvas.scale},C.touch.splice(o,1))}}function g(t){return{identifier:t.identifier,pageX:t.pageX,pageY:t.pageY}}function x(){C.applyAction.forEach(function(t){void 0!==t[C.mode+"list"]&&t[C.mode+"list"].forEach(function(e){if("cleardown"===e.type&&(C.mode="none",C.mouseDown=!1,C.mouseDownCnt=0),"console"===e.type&&console.log(e.text),"conditional"===e.type){if("position"===e.check){var n=void 0,o=void 0;C.data.objects.forEach(function(t){t.name===e.itemtocheck&&(n=t),t.name===e.position&&(o=t)});var i={x:n.position.current.x,y:n.position.current.y},a=C.imageList[n.image].context.getImageData(o.position.current.x-i.x,o.position.current.y-i.y,1,1).data;0!=a[3]&&(C.applyAction=[o],C.mode="true",x())}"var"===e.check&&C.vars[e.itemtocheck]===e.value&&(C.applyAction=[t],C.mode="true",x())}if("copyelement"===e.type){var r=document.getElementById(e.target),s=document.getElementById(e.source);void 0!==r&&void 0!==s&&null!==r&&null!==s&&(r.innerHTML=s.innerHTML,window.location.hash=t.name)}if("destposition"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&("string"==typeof e.destination?t.position.destination={x:t.position[e.destination].x,y:t.position[e.destination].y}:t.position.destination={x:e.destination.x,y:e.destination.y},void 0!==e.rate&&(t.position.rate=e.rate),void 0!==e.duration&&(t.position.duration=e.duration))}),"execute"===e.type&&window[e.function](e.params),"fade"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&(void 0===t.opacity&&(t.opacity={}),"string"==typeof e.destination?t.opacity.destination=t.opacity[e.destination]:t.opacity.destination=e.destination,void 0!==e.rate&&(t.opacity.rate=e.rate),void 0!==e.duration&&(t.opacity.duration=e.duration),t.opacity.showbefore=void 0===e.showbefore||e.showbefore,t.opacity.hideafter=void 0!==e.hideafter&&e.hideafter)}),"loadpage"===e.type&&(window.location.href=e.url),"modvar"===e.type&&"add"===e.operation&&(C.vars[e.name]+=e.amount),"swapimage"===e.type&&C.data.objects.forEach(function(t){void 0!==t.name&&t.name===e.name&&(t.image=e.image)}),"moveobject"===e.type&&C.data.objects.forEach(function(t){void 0!==t.name&&t.name===e.name&&("absolute"===e.frame&&(t.position.current={x:e.amount.x,y:e.amount.y}),"relative"===e.frame&&(t.position.current.x+=e.amount.x,t.position.current.y+=e.amount.y))}),"pstart"===e.type&&C.data.particles.forEach(function(t){void 0!==t.name&&t.name===e.name&&j.create(t)}),"scale"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&("increment"===e.frame&&(t.scale.current+=e.amount),"multiply"===e.frame&&(t.scale.current=t.scale.current*e.amount),"absolute"===e.frame&&(t.scale.current=e.amount))}),"scaledest"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&(t.scale.destination=e.destination,t.scale.rate=e.rate,t.scale.showbefore=void 0===e.showbefore||e.showbefore,t.scale.hideafter=void 0!==e.hideafter&&e.hideafter)}),"shapecolor"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&("default"===e.source&&(t.color=t.defaultcolor),"hover"===e.source&&(t.color=t.hovercolor),"selectcolor"===e.source&&(t.color=t.selectcolor),"value"===e.source&&(t.color=e.color))}),"slideobject"===e.type&&C.data.objects.forEach(function(t){void 0!==t.name&&(null!==C.dragging&&t.name!==C.dragging.name||t.name===e.name&&(void 0!==t.parent?(void 0===t.position.offset&&(t.position[mover]={x:0,y:0}),t.position.offset.x+=(C.position.x-C.prevPosition.x)/t.scale.current,t.position.offset.y+=(C.position.y-C.prevPosition.y)/t.scale.current):(t.position.current.x+=C.position.x-C.prevPosition.x,t.position.current.y+=C.position.y-C.prevPosition.y),C.dragging=t))}),"slideover"===e.type&&console.log("slideOver"),"url"===e.type){var r=document.getElementById(e.target);void 0!=r&&b(e.url,r)}"vis"===e.type&&C.data.objects.forEach(function(t){w(e,t)&&(t.show=e.show)})})}),C.applyAction=[]}function w(t,e){return void 0!==t.filter&&(!("group"===t.filter&&e.group.indexOf(t.name)<0)&&("object"!==t.filter||e.name===t.name))}function b(t,e){function n(){e.innerHTML=this.responseText}var o=new XMLHttpRequest;o.addEventListener("load",n),o.open("GET",t),o.send()}function L(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function E(t){var e=L(t);return{x:t.x/e,y:t.y/e}}function D(t,e){return Math.random()*(e-t)+t}function P(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function T(t,e,n){if(void 0===e)return{newCurrent:t,newDestination:e};if(void 0===e.x||void 0===e.y)return{newCurrent:t,newDestination:e};var o=t,i=e,a=Math.sqrt((i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y));if(a<n)o={x:i.x,y:i.y},i=void 0;else{var r={x:i.x-o.x,y:i.y-o.y},s=L(r);r={x:parseInt(r.x/s*n),y:parseInt(r.y/s*n)},o={x:o.x+r.x,y:o.y+r.y}}return{newCurrent:o,newDestination:i}}var C=new a,j=new r;"file"==n?o(e,i):i("string"==n?JSON.parse(e):e),this.external=function(t){C.external=!0,t.forEach(function(t){"selectonly"===t.command&&(C.applyAction=[],C.mode="click",C.data.objects.forEach(function(e){e.name===t.item&&C.applyAction.push(e)}))}),x()}}